"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["237"],{670:function(e,t,i){i.r(t),i.d(t,{Checkout:()=>Q});var r=i(3312),o=i(1102),n=i(1576),a=i(4204),l=i(3799),s=i(9144),c=i(8e3),d=i(9082),u=i(3003),p=i(6352),h=i(4676);let m=e=>e[0].toUpperCase()+e.slice(1),y=(e,t,i)=>e+(t-e)*i,g=({positionX:e,positionY:t})=>{let i=(0,s.useRef)(null),[o,n]=(0,s.useState)({x:256,y:256}),l="undefined"==typeof window||window.matchMedia("(hover: hover) and (pointer: fine)").matches;(0,s.useEffect)(()=>{if(!l)return;let r=()=>{n(i=>({x:y(i.x,e,.15),y:y(i.y,t,.15)})),i.current=requestAnimationFrame(r)};return i.current=requestAnimationFrame(r),()=>{i.current&&cancelAnimationFrame(i.current)}},[e,t,l]);let c=(0,s.useId)(),d=(0,s.useId)(),u=(0,s.useId)();return(0,r.BX)(a.Box,{elementDescriptor:a.descriptors.checkoutSuccessRings,as:"svg",viewBox:"0 0 512 512",sx:{position:"absolute",inset:0,pointerEvents:"none"},"aria-hidden":!0,children:[(0,r.BX)("defs",{children:[(0,r.BX)("radialGradient",{id:"clerk-checkout-success-gradient",children:[(0,r.tZ)("stop",{offset:"0%",style:{stopColor:"var(--ring-highlight)"}}),(0,r.tZ)("stop",{offset:"100%",stopOpacity:"0",style:{stopColor:"var(--ring-highlight)"}})]}),(0,r.tZ)("filter",{id:"clerk-checkout-success-blur-effect",children:(0,r.tZ)("feGaussianBlur",{stdDeviation:"10"})}),[{r:225,maskStart:10,maskEnd:90,id:c},{r:162.5,maskStart:15,maskEnd:85,id:d},{r:100,maskStart:20,maskEnd:80,id:u}].map(({maskStart:e,maskEnd:t,id:i})=>(0,r.BX)("linearGradient",{id:`gradient-${i}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[(0,r.tZ)("stop",{offset:`${e+5}%`,stopColor:"white",stopOpacity:"0"}),(0,r.tZ)("stop",{offset:`${e+35}%`,stopColor:"white",stopOpacity:"1"}),(0,r.tZ)("stop",{offset:`${t-35}%`,stopColor:"white",stopOpacity:"1"}),(0,r.tZ)("stop",{offset:`${t-5}%`,stopColor:"white",stopOpacity:"0"})]},i)),(0,r.tZ)("mask",{id:"clerk-checkout-success-mask",children:[{r:225,id:c},{r:162.5,id:d},{r:100,id:u}].map(({r:e,id:t})=>(0,r.tZ)("circle",{cx:"256",cy:"256",r:e,stroke:`url(#gradient-${t})`,fill:"none",strokeWidth:"1"},t))})]}),(0,r.BX)("g",{mask:"url(#clerk-checkout-success-mask)",children:[(0,r.tZ)("rect",{width:"512",height:"512",style:{fill:"var(--ring-fill)"}}),l&&(0,r.tZ)("rect",{id:"movingGradientHighlight",width:"256",height:"256",x:o.x-128,y:o.y-128,fill:"url(#clerk-checkout-success-gradient)",filter:"url(#clerk-checkout-success-blur-effect)"})]})]})},f=()=>{let e=(0,h.useRouter)(),{setIsOpen:t}=(0,o.useDrawerContext)(),{newSubscriptionRedirectUrl:i}=(0,n.useCheckoutContext)(),{checkout:y}=(0,l.z4)(),{totals:f,paymentMethod:b,planPeriodStart:x,freeTrialEndsAt:Z,needsPaymentMethod:$}=y,[k,B]=(0,s.useState)({x:256,y:256}),S=(0,p.Tb)(),{animations:v}=(0,a.useAppearance)().parsedLayout,w=!S&&!0===v,z=(0,s.useRef)(null),_="undefined"==typeof window||window.matchMedia("(hover: hover) and (pointer: fine)").matches;return f?(0,r.BX)(r.HY,{children:[(0,r.tZ)(o.Drawer.Body,{children:(0,r.BX)(a.Span,{elementDescriptor:a.descriptors.checkoutSuccessRoot,sx:e=>({"--ring-fill":e.colors.$neutralAlpha200,"--ring-highlight":e.colors.$success500,margin:"auto",position:"relative",aspectRatio:"1/1",display:"grid",width:"100%",flexShrink:0,transformOrigin:"bottom center",animationName:"scaleIn",animationDuration:`${u.bf.slowest}ms`,animationTimingFunction:u.$$.bezier,animationFillMode:"forwards",opacity:0,overflow:"hidden",backgroundColor:e.colors.$colorBackground,"@keyframes scaleIn":{"0%":{filter:"blur(10px)",transform:"scale(0.85)",opacity:0},"100%":{filter:"blur(0px)",transform:"scale(1)",opacity:1}},...!w&&{animation:"none",opacity:1}}),ref:z,onMouseMove:e=>{if(_&&z.current){let t=z.current.getBoundingClientRect(),i=e.clientX-t.left,r=e.clientY-t.top,o=t.width;o>0?B({x:i/o*512,y:r/o*512}):B({x:256,y:256})}},children:[(0,r.tZ)(g,{positionX:k.x,positionY:k.y}),(0,r.BX)(a.Box,{elementDescriptor:a.descriptors.checkoutSuccessBadge,sx:e=>({margin:"auto",gridArea:"1/1",display:"flex",position:"relative",width:e.sizes.$16,height:e.sizes.$16,borderRadius:e.radii.$circle,backgroundImage:"linear-gradient(180deg, rgba(255, 255, 255, 0.30) 0%, rgba(0, 0, 0, 0.12) 50%, rgba(0, 0, 0, 0.30) 95.31%)",boxShadow:"0px 4px 12px 0px rgba(0, 0, 0, 0.35), 0px 1px 0px 0px rgba(255, 255, 255, 0.05) inset",color:_?e.colors.$success500:e.colors.$colorForeground,":before":{content:'""',position:"absolute",inset:e.space.$1,borderRadius:e.radii.$circle,backgroundColor:e.colors.$colorBackground}}),children:[(0,r.tZ)("svg",{fill:"none",viewBox:"0 0 10 10","aria-hidden":"true",style:{position:"relative",margin:"auto",width:"1rem",height:"1rem"},children:(0,r.tZ)("path",{d:"m1 6 3 3 5-8",stroke:"currentColor",strokeWidth:"1.25",strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"1",pathLength:"1",style:{strokeDashoffset:"1",animation:w?`check ${u.bf.drawer}ms ${u.$$.bezier} forwards ${u.bf.slow}ms`:"none",...!w&&{strokeDashoffset:"0"}}})}),(0,r.tZ)("style",{children:`
              @keyframes check {
                0% {
                  stroke-dashoffset: 1;
                }
                100% {
                  stroke-dashoffset: 0;
                }
            `})]}),(0,r.BX)(a.Span,{sx:e=>({margin:"auto",gridArea:"1/1",position:"relative",textAlign:"center",transform:`translateY(${e.space.$20})`}),children:[(0,r.tZ)(a.Heading,{elementDescriptor:a.descriptors.checkoutSuccessTitle,as:"h2",textVariant:"h2",localizationKey:Z?(0,a.localizationKeys)("billing.checkout.title__trialSuccess"):$?(0,a.localizationKeys)("billing.checkout.title__paymentSuccessful"):(0,a.localizationKeys)("billing.checkout.title__subscriptionSuccessful"),sx:e=>({opacity:0,animationName:"slideUp",animationDuration:`${u.bf.slowest}ms`,animationTimingFunction:u.$$.bezier,animationFillMode:"forwards",color:e.colors.$colorForeground,"@keyframes slideUp":{"0%":{transform:"translateY(30px)",opacity:0},"100%":{transform:"translateY(0)",opacity:1}},...!w&&{opacity:1,animation:"none"}})}),(0,r.tZ)(a.Text,{elementDescriptor:a.descriptors.checkoutSuccessDescription,colorScheme:"secondary",sx:e=>({textAlign:"center",paddingInline:e.space.$8,marginBlockStart:e.space.$2,opacity:0,animationName:"slideUp",animationDuration:`${1.5*u.bf.slowest}ms`,animationTimingFunction:u.$$.bezier,animationFillMode:"forwards","@keyframes slideUp":{"0%":{transform:"translateY(30px)",opacity:0},"100%":{transform:"translateY(0)",opacity:1}},...!w&&{opacity:1,animation:"none"}}),localizationKey:$?(0,a.localizationKeys)("billing.checkout.description__paymentSuccessful"):(0,a.localizationKeys)("billing.checkout.description__subscriptionSuccessful")})]})]})}),(0,r.BX)(o.Drawer.Footer,{sx:e=>({rowGap:e.space.$4,animationName:"footerSlideInUp",animationDuration:`${u.bf.drawer}ms`,animationTimingFunction:u.$$.bezier,"@keyframes footerSlideInUp":{"0%":{transform:"translateY(100%)",opacity:0},"100%":{transform:"translateY(0)",opacity:1}},...!w&&{animation:"none"}}),children:[(0,r.BX)(c.a.Root,{children:[(0,r.BX)(c.a.Group,{variant:"secondary",children:[(0,r.tZ)(c.a.Title,{title:(0,a.localizationKeys)("billing.checkout.lineItems.title__totalPaid")}),(0,r.tZ)(c.a.Description,{text:`${f.totalDueNow.currencySymbol}${f.totalDueNow.amountFormatted}`})]}),Z?(0,r.BX)(c.a.Group,{variant:"secondary",children:[(0,r.tZ)(c.a.Title,{title:(0,a.localizationKeys)("billing.checkout.lineItems.title__freeTrialEndsAt")}),(0,r.tZ)(c.a.Description,{text:(0,d.p)(Z)})]}):null,(0,r.BX)(c.a.Group,{variant:"secondary",children:[(0,r.tZ)(c.a.Title,{title:$?(0,a.localizationKeys)("billing.checkout.lineItems.title__paymentMethod"):(0,a.localizationKeys)("billing.checkout.lineItems.title__subscriptionBegins")}),(0,r.tZ)(c.a.Description,{text:$?b?"card"!==b.paymentType?`${m(b.paymentType)}`:`${m(b.cardType)} \u{22EF} ${b.last4}`:"–":x?(0,d.p)(new Date(x)):"–"})]})]}),(0,r.tZ)(a.Button,{onClick:()=>{i&&e.navigate(i),t&&t(!1)},localizationKey:(0,a.localizationKeys)("formButtonPrimary")})]})]}):null};var b=i(2418),x=i(2672),Z=i(7291),$=i(3146),k=i(9732),B=i(8870),S=i(2189),v=i(4174),w=i(4557),z=i(9176),_=i(5746);let D=e=>e[0].toUpperCase()+e.slice(1),C="payment_method_id",P=(0,x.withCardStateProvider)(()=>{let{checkout:e}=(0,l.z4)(),{id:t,plan:i,totals:n,isImmediatePlanChange:s,planPeriod:d,freeTrialEndsAt:u}=e;if(!t)return null;let p=!!n.credit?.amount&&n.credit.amount>0,h=!!n.pastDue?.amount&&n.pastDue.amount>0,m="month"===d?i.fee:i.annualMonthlyFee;return(0,r.BX)(o.Drawer.Body,{children:[(0,r.tZ)(a.Box,{elementDescriptor:a.descriptors.checkoutFormLineItemsRoot,sx:e=>({padding:e.space.$4,borderBottomWidth:e.borderWidths.$normal,borderBottomStyle:e.borderStyles.$solid,borderBottomColor:e.colors.$borderAlpha100}),children:(0,r.BX)(c.a.Root,{children:[(0,r.BX)(c.a.Group,{children:[(0,r.tZ)(c.a.Title,{title:i.name,description:"annual"===d?(0,a.localizationKeys)("billing.billedAnnually"):void 0,badge:i.freeTrialEnabled&&u?(0,r.tZ)(_.u,{subscription:{status:"free_trial"}}):null}),(0,r.tZ)(c.a.Description,{prefix:"annual"===d?"x12":void 0,text:`${m.currencySymbol}${m.amountFormatted}`,suffix:(0,a.localizationKeys)("billing.checkout.perMonth")})]}),(0,r.BX)(c.a.Group,{borderTop:!0,variant:"tertiary",children:[(0,r.tZ)(c.a.Title,{title:(0,a.localizationKeys)("billing.subtotal")}),(0,r.tZ)(c.a.Description,{text:`${n.subtotal.currencySymbol}${n.subtotal.amountFormatted}`})]}),p&&(0,r.BX)(c.a.Group,{variant:"tertiary",children:[(0,r.tZ)(c.a.Title,{title:(0,a.localizationKeys)("billing.creditRemainder")}),(0,r.tZ)(c.a.Description,{text:`- ${n.credit?.currencySymbol}${n.credit?.amountFormatted}`})]}),h&&(0,r.BX)(c.a.Group,{variant:"tertiary",children:[(0,r.BX)(k.u.Root,{children:[(0,r.tZ)(k.u.Trigger,{children:(0,r.tZ)(c.a.Title,{title:(0,a.localizationKeys)("billing.pastDue"),icon:v.I$})}),(0,r.tZ)(k.u.Content,{text:(0,a.localizationKeys)("billing.checkout.pastDueNotice")})]}),(0,r.tZ)(c.a.Description,{text:`${n.pastDue?.currencySymbol}${n.pastDue?.amountFormatted}`})]}),!!u&&!!i.freeTrialDays&&(0,r.BX)(c.a.Group,{variant:"tertiary",children:[(0,r.tZ)(c.a.Title,{title:(0,a.localizationKeys)("billing.checkout.totalDueAfterTrial",{days:i.freeTrialDays})}),(0,r.tZ)(c.a.Description,{text:`${n.grandTotal?.currencySymbol}${n.grandTotal?.amountFormatted}`})]}),(0,r.BX)(c.a.Group,{borderTop:!0,children:[(0,r.tZ)(c.a.Title,{title:(0,a.localizationKeys)("billing.totalDueToday")}),(0,r.tZ)(c.a.Description,{text:`${n.totalDueNow.currencySymbol}${n.totalDueNow.amountFormatted}`})]})]})}),!s&&(0,r.tZ)(a.Box,{elementDescriptor:a.descriptors.checkoutFormLineItemsRoot,sx:e=>({paddingBlockStart:e.space.$4,paddingInline:e.space.$4}),children:(0,r.tZ)(a.Text,{localizationKey:(0,a.localizationKeys)("billing.checkout.downgradeNotice"),variant:"caption",colorScheme:"secondary"})}),(0,r.tZ)(T,{})]})}),K=()=>{let{onSubscriptionComplete:e}=(0,n.useCheckoutContext)(),{checkout:t}=(0,l.z4)(),{id:i,confirm:r}=t,o=(0,x.useCardState)();if(!i)throw Error("Checkout not found");let a=async t=>{o.setLoading(),o.setError(void 0);let{data:i,error:n}=await r(t);n?(0,B.S3)(n,[],o.setError):i&&e?.(),o.setIdle()};return{payWithExistingPaymentMethod:e=>(e.preventDefault(),a({paymentSourceId:new FormData(e.currentTarget).get(C)})),addPaymentMethodAndPay:e=>a(e),payWithTestCard:()=>a({gateway:"stripe",useTestCard:!0}),payWithoutPaymentMethod:e=>(e.preventDefault(),a({}))}},T=()=>{let{checkout:e}=(0,l.z4)(),{id:t}=e,{isLoading:i}=(0,n.usePaymentMethods)();return t?i?(0,r.tZ)(a.Spinner,{sx:{margin:"auto"}}):(0,r.tZ)(X,{}):null},X=()=>{let{checkout:e}=(0,l.z4)(),{id:t,isImmediatePlanChange:i,needsPaymentMethod:o}=e,{data:c}=(0,n.usePaymentMethods)(),[d,u]=(0,s.useState)(()=>c.length>0?"existing":"new");return t?(0,r.BX)(a.Col,{elementDescriptor:a.descriptors.checkoutFormElementsRoot,gap:4,sx:e=>({padding:e.space.$4}),children:[(0,r.tZ)(r.HY,{children:c.length>0&&i&&o&&(0,r.BX)(Z.s.Root,{"aria-label":"Payment method source",value:d,onChange:e=>u(e),size:"lg",fullWidth:!0,children:[(0,r.tZ)(Z.s.Button,{value:"existing",text:(0,a.localizationKeys)("billing.paymentMethods__label")}),(0,r.tZ)(Z.s.Button,{value:"new",text:(0,a.localizationKeys)("billing.addPaymentMethod__label")})]})}),o?"existing"===d?(0,r.tZ)(L,{paymentMethods:c}):"new"===d&&(0,r.tZ)(M,{}):(0,r.tZ)(F,{})]}):null},A=()=>{let{isLoading:e}=(0,x.useCardState)(),{payWithTestCard:t}=K();return(0,r.BX)(a.Box,{sx:e=>({background:e.colors.$neutralAlpha50,padding:e.space.$2x5,borderRadius:e.radii.$md,borderWidth:e.borderWidths.$normal,borderStyle:e.borderStyles.$solid,borderColor:e.colors.$borderAlpha100,display:"flex",flexDirection:"column",rowGap:e.space.$2,position:"relative"}),children:[(0,r.tZ)(a.Box,{sx:e=>({position:"absolute",inset:0,background:`repeating-linear-gradient(-45deg,${e.colors.$warningAlpha100},${e.colors.$warningAlpha100} 6px,${e.colors.$warningAlpha150} 6px,${e.colors.$warningAlpha150} 12px)`,maskImage:"linear-gradient(transparent 20%, black)",pointerEvents:"none"})}),(0,r.BX)(a.Flex,{sx:e=>({alignItems:"center",justifyContent:"center",flexDirection:"column",rowGap:e.space.$2}),children:[(0,r.tZ)(a.Text,{sx:e=>({color:e.colors.$warning500,fontWeight:e.fontWeights.$semibold}),localizationKey:(0,a.localizationKeys)("billing.paymentMethod.dev.developmentMode")}),(0,r.tZ)(a.Button,{type:"button",block:!0,variant:"bordered",localizationKey:(0,a.localizationKeys)("userProfile.billingPage.paymentMethodsSection.payWithTestCardButton"),colorScheme:"secondary",isLoading:e,onClick:t})]})]})},R=()=>{let{checkout:e}=(0,l.z4)(),{status:t,freeTrialEndsAt:i,totals:r}=e;if("needs_initialization"===t)throw Error("Clerk: Invalid state");return i?(0,a.localizationKeys)("billing.startFreeTrial"):r.totalDueNow.amount>0?(0,a.localizationKeys)("billing.pay",{amount:`${r.totalDueNow.currencySymbol}${r.totalDueNow.amountFormatted}`}):(0,a.localizationKeys)("billing.subscribe")},F=(0,x.withCardStateProvider)(()=>{let{for:e}=(0,n.useCheckoutContext)(),{payWithoutPaymentMethod:t}=K(),i=(0,x.useCardState)();return(0,r.BX)(a.Form,{onSubmit:t,sx:E,children:[(0,r.tZ)(b.Z.Alert,{children:i.error}),(0,r.tZ)(I,{})]})}),M=(0,x.withCardStateProvider)(()=>{let{addPaymentMethodAndPay:e}=K(),t=R(),{checkout:i}=(0,l.z4)();return(0,r.BX)(w.fC,{onSuccess:e,checkout:i,children:[(0,r.tZ)(S.P,{children:(0,r.tZ)(A,{})}),(0,r.tZ)(w.OL,{text:t})]})}),I=e=>{let t=(0,x.useCardState)(),i=R();return(0,r.tZ)(a.Button,{type:"submit",colorScheme:"primary",size:"sm",textVariant:"buttonLarge",sx:{width:"100%"},isLoading:t.isLoading,localizationKey:i,...e})},E=e=>({display:"flex",flexDirection:"column",rowGap:e.space.$4}),L=(0,x.withCardStateProvider)(({paymentMethods:e})=>{let{checkout:t}=(0,l.z4)(),{paymentMethod:i,isImmediatePlanChange:o,needsPaymentMethod:n}=t,{payWithExistingPaymentMethod:c}=K(),d=(0,x.useCardState)(),[u,p]=(0,s.useState)(i||e.find(e=>e.isDefault)),h=(0,s.useMemo)(()=>e.map(e=>{let t="card"!==e.paymentType?`${D(e.paymentType)}`:`${D(e.cardType)} \u{22EF} ${e.last4}`;return{value:e.id,label:t}}),[e]);return(0,r.BX)(a.Form,{onSubmit:c,sx:E,children:[o&&n?(0,r.BX)($.Ph,{elementId:"paymentMethod",options:h,value:u?.id||null,onChange:t=>{p(e.find(e=>e.id===t.value))},portal:!0,children:[(0,r.tZ)("input",{name:C,type:"hidden",value:u?.id}),(0,r.tZ)($.UN,{icon:v.jC,sx:e=>({justifyContent:"space-between",backgroundColor:e.colors.$colorBackground}),children:u&&(0,r.tZ)(z.Q,{paymentMethod:u})}),(0,r.tZ)($.pp,{sx:e=>({paddingBlock:e.space.$1,color:e.colors.$colorForeground})})]}):(0,r.tZ)("input",{name:C,type:"hidden",value:u?.id}),(0,r.tZ)(b.Z.Alert,{children:d.error}),(0,r.tZ)(I,{})]})});var j=i(276);let W=()=>{let{checkout:e}=(0,l.z4)();return(0,s.useEffect)(()=>(e.start(),e.clear),[]),null},U=({children:e})=>{let{planId:t,planPeriod:i,for:o}=(0,j.w6)();return(0,r.BX)(l.hA,{for:o,planId:t,planPeriod:i,children:[(0,r.tZ)(W,{}),e]})},G=({children:e,name:t})=>{let{checkout:i}=(0,l.z4)();return i.status!==t?null:e},Y=({children:e,status:t})=>{let{checkout:i}=(0,l.z4)(),{fetchStatus:r,error:o}=i;return(0,s.useMemo)(()=>{if("error"===r){let e=o.errors.map(e=>e.code);if(e.includes("missing_payer_email"))return"missing_payer_email";if(e.includes("invalid_plan_change"))return"invalid_plan_change"}return r},[r])!==t?null:e};var N=i(9117),H=i(9140);let O=()=>{let{checkout:e}=(0,l.z4)(),{translateError:t}=(0,a.useLocalizations)(),{t:i}=(0,a.useLocalizations)();return(0,r.tZ)(o.Drawer.Body,{children:(0,r.tZ)(a.Flex,{align:"center",justify:"center",sx:e=>({height:"100%",padding:e.space.$4,fontSize:e.fontSizes.$md}),children:(0,r.tZ)(N.b,{variant:"danger",colorScheme:"danger",children:e.error?t(e.error.errors[0]):i((0,a.localizationKeys)("unstable__errors.form_param_value_invalid"))})})})},V=()=>{let{planPeriod:e}=(0,n.useCheckoutContext)(),{checkout:t}=(0,l.z4)(),i=t.error,d=(0,s.useMemo)(()=>{let e=i?.errors.find(e=>"invalid_plan_change"===e.code);return e?.meta?.plan},[i]),u=(0,s.useMemo)(()=>{let e=i?.errors.find(e=>"invalid_plan_change"===e.code);return e?.meta?.isPlanUpgradePossible||!1},[i]);return d?(0,r.tZ)(o.Drawer.Body,{children:(0,r.BX)(a.Flex,{gap:4,direction:"col",children:[(0,r.tZ)(a.Box,{elementDescriptor:a.descriptors.checkoutFormLineItemsRoot,sx:e=>({padding:e.space.$4,borderBottomWidth:e.borderWidths.$normal,borderBottomStyle:e.borderStyles.$solid,borderBottomColor:e.colors.$borderAlpha100}),children:(0,r.tZ)(c.a.Root,{children:(0,r.BX)(c.a.Group,{children:[(0,r.tZ)(c.a.Title,{title:d.name,description:"annual"===e?(0,a.localizationKeys)("billing.billedAnnually"):void 0}),(0,r.tZ)(c.a.Description,{prefix:"annual"===e?"x12":void 0,text:`${d.currency_symbol}${"month"===e?d.amount_formatted:d.annual_monthly_amount_formatted}`,suffix:(0,a.localizationKeys)("billing.checkout.perMonth")})]})})}),(0,r.tZ)(a.Box,{sx:e=>({padding:e.space.$4}),children:(0,r.tZ)(N.b,{variant:"info",colorScheme:"info",title:u?(0,a.localizationKeys)("billing.cannotSubscribeMonthly"):(0,a.localizationKeys)("billing.cannotSubscribeUnrecoverable")})})]})}):null},q=()=>{let{checkout:e}=(0,l.z4)(),{setIsOpen:t}=(0,o.useDrawerContext)();return(0,r.tZ)(o.Drawer.Body,{children:(0,r.tZ)(a.Box,{sx:e=>({padding:e.space.$4}),children:(0,r.tZ)(H._,{title:(0,a.localizationKeys)("billing.checkout.emailForm.title"),subtitle:(0,a.localizationKeys)("billing.checkout.emailForm.subtitle"),onSuccess:()=>void e.start(),onReset:()=>t(!1),disableAutoFocus:!0})})})},Q=e=>(0,r.tZ)(a.Flow.Root,{flow:"checkout",children:(0,r.tZ)(a.Flow.Part,{children:(0,r.tZ)(n.SubscriberTypeContext.Provider,{value:e.for||"user",children:(0,r.tZ)(n.CheckoutContext.Provider,{value:{componentName:"Checkout",...e},children:(0,r.BX)(o.Drawer.Content,{children:[(0,r.tZ)(o.Drawer.Header,{title:(0,a.localizationKeys)("billing.checkout.title")}),(0,r.BX)(U,{children:[(0,r.BX)(G,{name:"needs_initialization",children:[(0,r.tZ)(Y,{status:"fetching",children:(0,r.tZ)(a.Spinner,{sx:{margin:"auto"}})}),(0,r.tZ)(Y,{status:"invalid_plan_change",children:(0,r.tZ)(V,{})}),(0,r.tZ)(Y,{status:"missing_payer_email",children:(0,r.tZ)(q,{})}),(0,r.tZ)(Y,{status:"error",children:(0,r.tZ)(O,{})})]}),(0,r.tZ)(G,{name:"completed",children:(0,r.tZ)(f,{})}),(0,r.tZ)(G,{name:"needs_confirmation",children:(0,r.tZ)(P,{})})]})]})})})})})},4557:function(e,t,i){i.d(t,{hG:()=>z,ph:()=>w,fC:()=>S,OL:()=>_});var r=i(3312),o=i(3799),n=i(9144),a=i(2418),l=i(2672),s=i(431),c=i(9460),d=i(8487),u=i(8849),p=i(8870),h=i(1576),m=i(4204);let y=e=>(0,r.tZ)(m.Box,{sx:[e=>({height:e.space.$2,width:"100%",borderRadius:e.radii.$md,background:e.colors.$neutralAlpha100}),e.sx]}),g=()=>(0,r.tZ)(y,{sx:e=>({height:e.space.$10,width:"100%"})}),f=e=>(0,r.tZ)(m.Flex,{direction:"col",gap:2,children:e.children}),b=()=>(0,r.tZ)(m.Box,{"aria-label":"Loading...",sx:{position:"relative",minHeight:0,flex:1,overflowY:"auto"},children:(0,r.BX)(m.Flex,{direction:"col",gap:5,children:[(0,r.BX)(f,{children:[(0,r.tZ)(y,{sx:e=>({height:e.space.$3,width:e.sizes.$24})}),(0,r.tZ)(g,{})]}),(0,r.BX)(m.Grid,{columns:2,gap:4,children:[(0,r.BX)(f,{children:[(0,r.tZ)(y,{sx:e=>({height:e.space.$3,width:e.sizes.$20})}),(0,r.tZ)(g,{})]}),(0,r.BX)(f,{children:[(0,r.tZ)(y,{sx:e=>({height:e.space.$3,width:e.sizes.$24})}),(0,r.tZ)(g,{})]})]}),(0,r.BX)(f,{children:[(0,r.tZ)(y,{sx:e=>({height:e.space.$3,width:e.sizes.$16})}),(0,r.tZ)(g,{})]}),(0,r.BX)(f,{children:[(0,r.tZ)(y,{}),(0,r.tZ)(y,{}),(0,r.tZ)(y,{sx:{width:"66.666667%"}})]})]})}),[x,Z]=(0,o.uH)("AddPaymentMethodRoot"),$=({children:e,checkout:t,...i})=>{let a=(0,h.useSubscriberTypeContext)(),l=(0,n.useRef)(null),{t:s}=(0,m.useLocalizations)(),[c,d]=(0,n.useState)(void 0),[p,y]=(0,n.useState)(void 0),[g,f]=(0,n.useState)(void 0),b=(e=>{let t=(0,m.useAppearance)().parsedInternalTheme;return(0,n.useMemo)(()=>{if(!e)return;let{colors:i,fontWeights:r,fontSizes:o,radii:n,space:a}=t;return{colorPrimary:(0,u.Aj)(e,i.$primary500,i.$colorBackground),colorBackground:(0,u.Aj)(e,i.$colorInput,i.$colorBackground),colorText:(0,u.Aj)(e,i.$colorForeground,i.$colorBackground),colorTextSecondary:(0,u.Aj)(e,i.$colorMutedForeground,i.$colorBackground),colorSuccess:(0,u.Aj)(e,i.$success500,i.$colorBackground),colorDanger:(0,u.Aj)(e,i.$danger500,i.$colorBackground),colorWarning:(0,u.Aj)(e,i.$warning500,i.$colorBackground),fontWeightNormal:(0,u.uj)(e,"font-weight",r.$normal.toString()),fontWeightMedium:(0,u.uj)(e,"font-weight",r.$medium.toString()),fontWeightBold:(0,u.uj)(e,"font-weight",r.$bold.toString()),fontSizeXl:(0,u.uj)(e,"font-size",o.$xl),fontSizeLg:(0,u.uj)(e,"font-size",o.$lg),fontSizeSm:(0,u.uj)(e,"font-size",o.$md),fontSizeXs:(0,u.uj)(e,"font-size",o.$sm),borderRadius:(0,u.uj)(e,"border-radius",n.$lg),spacingUnit:(0,u.uj)(e,"padding",a.$1)}},[t,e])})(l.current);return(0,r.BX)(x.Provider,{value:{value:{headerTitle:c,headerSubtitle:p,submitLabel:g,setHeaderTitle:d,setHeaderSubtitle:y,setSubmitLabel:f,checkout:t,...i}},children:[(0,r.tZ)("div",{ref:l,style:{display:"none"}}),(0,r.tZ)(o.pe,{checkout:t,for:a,stripeAppearance:b,paymentDescription:s((0,m.localizationKeys)(t?.planPeriod==="month"?"billing.paymentMethod.applePayDescription.monthly":"billing.paymentMethod.applePayDescription.annual")),children:e})]})},k=e=>{let{isProviderReady:t}=(0,o.Wh)();return t?null:e.children},B=e=>{let{isProviderReady:t}=(0,o.Wh)();return t?(0,r.tZ)(r.HY,{children:e.children}):null},S=e=>{let{children:t,...i}=e;return(0,r.BX)($,{...i,children:[(0,r.tZ)(k,{children:(0,r.tZ)(m.Flex,{direction:"row",align:"center",justify:"center",sx:e=>({width:"100%",minHeight:e.sizes.$60}),children:(0,r.tZ)(m.Spinner,{size:"lg",colorScheme:"primary",elementDescriptor:m.descriptors.spinner})})}),(0,r.tZ)(B,{children:(0,r.tZ)(D,{children:t})})]})},v=(e,t)=>{(0,n.useRef)(()=>{t(e)}),(0,n.useEffect)(()=>{t(e)},[e,t])},w=({text:e})=>{let{setHeaderTitle:t}=Z();return v(e,t),null},z=({text:e})=>{let{setHeaderSubtitle:t}=Z();return v(e,t),null},_=({text:e})=>{let{setSubmitLabel:t}=Z();return v(e,t),null},D=({children:e})=>{let{headerTitle:t,headerSubtitle:i,submitLabel:n,checkout:u,onSuccess:y,cancelAction:g}=Z(),f=(0,l.useCardState)(),x=(0,h.useSubscriberTypeLocalizationRoot)(),{isFormReady:$,submit:k,reset:B}=(0,o.Wh)(),S=async e=>{e.preventDefault(),f.setLoading(),f.setError(void 0);let{data:t,error:i}=await k();if(!i)try{await y(t)}catch(e){(0,p.S3)(e,[],f.setError)}finally{f.setIdle(),B()}};return(0,r.tZ)(d.Y,{headerTitle:t,headerSubtitle:i,children:(0,r.BX)(s.l.Root,{onSubmit:S,sx:e=>({display:"flex",flexDirection:"column",rowGap:e.space.$3}),children:[e,(0,r.tZ)(o.Y7,{fallback:(0,r.tZ)(b,{})}),(0,r.tZ)(a.Z.Alert,{children:f.error}),(0,r.tZ)(c.A,{isDisabled:!$,submitLabel:n??(0,m.localizationKeys)(`${x}.billingPage.paymentMethodsSection.formButtonPrimary__add`),onReset:g,hideReset:!g,sx:{flex:u?1:void 0}})]})})}},9176:function(e,t,i){i.d(t,{Q:()=>a});var r=i(3312),o=i(4204),n=i(4174);let a=({paymentMethod:e})=>(0,r.BX)(o.Flex,{sx:{overflow:"hidden"},gap:2,align:"baseline",elementDescriptor:o.descriptors.paymentMethodRow,children:[(0,r.tZ)(o.Icon,{icon:"card"===e.paymentType?n.aB:n.Nn,sx:e=>({alignSelf:"center",color:e.colors.$colorMutedForeground}),elementDescriptor:o.descriptors.paymentMethodRowIcon}),(0,r.tZ)(o.Text,{sx:e=>({color:e.colors.$colorForeground,textTransform:"capitalize"}),truncate:!0,elementDescriptor:o.descriptors.paymentMethodRowType,children:"card"===e.paymentType?e.cardType:e.paymentType}),(0,r.tZ)(o.Text,{sx:e=>({color:e.colors.$colorMutedForeground}),variant:"caption",truncate:!0,elementDescriptor:o.descriptors.paymentMethodRowValue,children:"card"===e.paymentType?`\u{22EF} ${e.last4}`:null}),e.isDefault&&(0,r.tZ)(o.Badge,{elementDescriptor:o.descriptors.paymentMethodRowBadge,elementId:o.descriptors.paymentMethodRowBadge.setId("default"),localizationKey:(0,o.localizationKeys)("badge__default")}),"expired"===e.status&&(0,r.tZ)(o.Badge,{elementDescriptor:o.descriptors.paymentMethodRowBadge,elementId:o.descriptors.paymentMethodRowBadge.setId("expired"),colorScheme:"danger",localizationKey:(0,o.localizationKeys)("badge__expired")})]})},5746:function(e,t,i){i.d(t,{u:()=>l});var r=i(3312),o=i(4204);let n={active:"badge__activePlan",upcoming:"badge__upcomingPlan",past_due:"badge__pastDuePlan",free_trial:"badge__freeTrial"},a={active:"secondary",upcoming:"primary",past_due:"warning",free_trial:"secondary"},l=({subscription:e,elementDescriptor:t})=>(0,r.tZ)(o.Badge,{elementDescriptor:t,colorScheme:a[e.status],localizationKey:(0,o.localizationKeys)(n[e.status])})},9140:function(e,t,i){i.d(t,{_:()=>k});var r=i(3312),o=i(3799),n=i(9144),a=i(2672),l=i(431),s=i(9460),c=i(8487),d=i(8870),u=i(6788),p=i(9281),h=i(1576),m=i(7703),y=i(207),g=i(4676),f=i(4108),b=i(4204),x=i(6352);let Z=e=>{let{navigate:t}=(0,g.useRouter)(),{email:i,nextStep:o,onReset:l}=e,c=(0,a.useCardState)(),u=(0,h.useUserProfileContext)(),{startEnterpriseSSOLinkFlow:p}=(0,x.eq)(i);async function m(){await t(i.verification.externalVerificationRedirectURL?.href||"")}return n.useEffect(()=>{let{mode:e,componentName:t}=u;p({redirectUrl:"modal"===e?(0,f.bX)({url:window.location.href,componentName:t}):window.location.href}).then(()=>o()).catch(e=>(0,d.S3)(e,[],c.setError))},[]),(0,r.BX)(r.HY,{children:[(0,r.tZ)(b.Flex,{justify:"center",children:(0,r.tZ)(b.Button,{variant:"link",onClick:m,localizationKey:(0,b.localizationKeys)("userProfile.emailAddressPage.enterpriseSSOLink.formButton")})}),(0,r.tZ)(s.K,{children:(0,r.tZ)(b.Button,{variant:"ghost",localizationKey:(0,b.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:b.descriptors.formButtonReset,onClick:l})})]})};var $=i(2786);let k=(0,a.withCardStateProvider)(e=>{let{emailId:t,onSuccess:i,onReset:g,disableAutoFocus:f=!1}=e,b=(0,a.useCardState)(),{user:x}=(0,o.aF)(),k=(0,h.useEnvironment)(),v=(0,o.WZ)(e=>x?.createEmailAddress({email:e})),w=n.useRef(x?.emailAddresses.find(e=>e.id===t)),z=S(w.current,k),_=(0,p.a2)({defaultStep:+!!w.current,onNextStep:()=>b.setError(void 0)}),D=(0,u.Yp)("emailAddress","",{type:"email",label:(0,m.u1)("formFieldLabel__emailAddress"),placeholder:(0,m.u1)("formFieldInputPlaceholder__emailAddress"),isRequired:!0}),C=D.value.length>1&&x?.username!==D.value,P=async e=>{if(e.preventDefault(),x)return v(D.value).then(e=>{w.current=e,_.nextStep()}).catch(e=>(0,d.S3)(e,[D],b.setError))},K=B(z);return(0,r.BX)(p.en,{..._.props,children:[(0,r.tZ)(c.Y,{headerTitle:e.title||(0,m.u1)("userProfile.emailAddressPage.title"),headerSubtitle:e.subtitle||(0,m.u1)("userProfile.emailAddressPage.formHint"),children:(0,r.BX)(l.l.Root,{onSubmit:P,children:[(0,r.tZ)(l.l.ControlRow,{elementId:D.id,children:(0,r.tZ)(l.l.PlainInput,{...D.props,autoFocus:!f})}),(0,r.tZ)(s.A,{submitLabel:(0,m.u1)("userProfile.formButtonPrimary__add"),isDisabled:!C,onReset:g})]})}),(0,r.BX)(c.Y,{headerTitle:(0,m.u1)("userProfile.emailAddressPage.verifyTitle"),headerSubtitle:(0,m.u1)(`${K}.formSubtitle`,{identifier:w.current?.emailAddress||""}),children:["email_link"===z&&(0,r.tZ)($.K,{nextStep:i,email:w.current,onReset:g}),"email_code"===z&&(0,r.tZ)(y.H,{nextStep:i,identification:w.current,identifier:w.current?.emailAddress,prepareVerification:()=>w.current?.prepareVerification({strategy:"email_code"}),onReset:g}),"enterprise_sso"===z&&(0,r.tZ)(Z,{nextStep:i,email:w.current,onReset:g})]})]})}),B=e=>{switch(e){case"email_code":return"userProfile.emailAddressPage.emailCode";case"enterprise_sso":return"userProfile.emailAddressPage.enterpriseSSOLink";case"email_link":return"userProfile.emailAddressPage.emailLink";default:throw Error(`Unsupported strategy for email verification: ${e}`)}},S=(e,t)=>e?.matchesSsoConnection?"enterprise_sso":!function(e){let{userSettings:t}=e,{email_address:i}=t.attributes;return!!(i?.enabled&&i?.verifications.includes("email_link"))}(t)?"email_code":"email_link"},207:function(e,t,i){i.d(t,{H:()=>u});var r=i(3312),o=i(9144),n=i(2667),a=i(2672),l=i(431),s=i(9460),c=i(8870),d=i(4204);let u=e=>{let t=(0,a.useCardState)(),{nextStep:i,identification:u,identifier:p,onReset:h,prepareVerification:m}=e,y=()=>m?.()?.catch(e=>(0,c.S3)(e,[],t.setError)),g=(0,n.e3)({onCodeEntryFinished:(e,t,i)=>{u?.attemptVerification({code:e}).then(()=>t()).catch(i)},onResendCodeClicked:y,onResolve:i});return o.useEffect(()=>{y()},[]),(0,r.BX)(r.HY,{children:[(0,r.tZ)(l.l.OTPInput,{...g,label:(0,d.localizationKeys)("userProfile.emailAddressPage.emailCode.formTitle"),description:(0,d.localizationKeys)("userProfile.emailAddressPage.emailCode.formSubtitle",{identifier:p||""}),resendButton:(0,d.localizationKeys)("userProfile.emailAddressPage.emailCode.resendButton"),centerAlign:!1}),(0,r.BX)(s.K,{children:[(0,r.tZ)(d.Button,{isLoading:g.isLoading,localizationKey:(0,d.localizationKeys)("formButtonPrimary__verify"),elementDescriptor:d.descriptors.formButtonPrimary,onClick:g.onFakeContinue}),(0,r.tZ)(d.Button,{variant:"ghost",isDisabled:g.isLoading,localizationKey:(0,d.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:d.descriptors.formButtonReset,onClick:h})]})]})}},2786:function(e,t,i){i.d(t,{K:()=>m,M:()=>y});var r=i(3312),o=i(9144),n=i(2672),a=i(9460),l=i(5495),s=i(8870),c=i(9281),d=i(6749),u=i(1576),p=i(4204),h=i(6352);let m=e=>{let{email:t,nextStep:i,onReset:c}=e,m=(0,n.useCardState)(),y=(0,u.useUserProfileContext)(),{startEmailLinkFlow:g}=(0,h.E2)(t),{displayConfig:f}=(0,u.useEnvironment)();function b(){let{routing:e}=y,t="virtual"===e?f.userProfileUrl:"";g({redirectUrl:(0,d.Uu)({ctx:y,baseUrl:t,intent:"profile"})}).then(()=>i()).catch(e=>(0,s.S3)(e,[],m.setError))}return o.useEffect(()=>{b()},[]),(0,r.BX)(r.HY,{children:[(0,r.tZ)(l.V,{resendButton:(0,p.localizationKeys)("userProfile.emailAddressPage.emailLink.resendButton"),onResendCodeClicked:b}),(0,r.tZ)(a.K,{children:(0,r.tZ)(p.Button,{variant:"ghost",localizationKey:(0,p.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:p.descriptors.formButtonReset,onClick:c})})]})},y=()=>(0,r.tZ)(c.Ej,{title:(0,p.localizationKeys)("signUp.emailLink.verifiedSwitchTab.title"),subtitle:(0,p.localizationKeys)("signUp.emailLink.verifiedSwitchTab.subtitle"),status:"verified"})}}]);